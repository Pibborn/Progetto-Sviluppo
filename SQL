-- PER AUTO INCREMENT:
-- GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1)


DROP TABLE Proposta;
DROP TABLE Messaggio;
DROP TABLE SistemaCifratura;
DROP TABLE Studente;

CREATE TABLE Studente (
    id int PRIMARY KEY GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    nickname    varchar(20),
    password    varchar(32),
    nome        varchar(20),
    cognome     varchar(20)
);

CREATE TABLE Messaggio (
    id              int PRIMARY KEY GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    mittente        int,
    destinatario    int,
    testo           varchar(32672),
    testoCifrato    varchar(32672),
    lingua          varchar(20),
    titolo          varchar(40),
    bozza           boolean,
    letto           boolean,
    FOREIGN KEY (mittente) REFERENCES Studente(id),
    FOREIGN KEY (destinatario) REFERENCES Studente(id)
);

CREATE TABLE SistemaCifratura (
    id          int PRIMARY KEY GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    creatore    int,
    metodo      varchar(20),
    chiave      varchar(20),
    FOREIGN KEY (creatore) REFERENCES Studente(id)
);

CREATE TABLE Proposta (
    id          int PRIMARY KEY GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
    stato       varchar(20),
    proponente  int,
    partner     int,
    metodo      varchar(20),
    chiave      varchar(20),
    FOREIGN KEY (proponente) REFERENCES Studente(id),
    FOREIGN KEY (partner) REFERENCES Studente(id)
);

INSERT INTO Studente (nickname, password, nome, cognome) VALUES
    ('tory', 'tory', 'Pietro', 'Torasso'),
    ('felix', 'felix', 'Felice', 'Cardone'),
    ('rosa', 'rosa', 'Rosa', 'Blu'),
    ('mario', 'mario', 'Mario', 'Rossi'),
    ('rossana', 'rossana', 'Rossana', 'Verdi'),
    ('gianni', 'gianni', 'Gianni', 'Ottimo');
       
INSERT INTO Messaggio (mittente, destinatario, testo, testoCifrato, lingua, titolo, bozza, letto) VALUES
    (1, 2, 'testo in chiaro', 'testo cifrato', 'Italiano', 'Un titolo a caso', True, False);


-- POPOLAMENTO TABELLA "SISTEMACIFRATURA"
INSERT into SISTEMACIFRATURA (creatore, metodo, chiave) VALUES
    (1, 'pseudocasuale','CIPOLLA'),
    (1, 'cesare','1'),
    (2, 'pseudocasuale','55'),
    (2, 'parolachiave','papaslkfdkfjdfjl');


-- POPOLAMENTO TABELLA "PROPOSTA"
INSERT INTO Proposta (stato, proponente, partner, metodo, chiave) VALUES
    ('accepted', 1, 2, 'cesare','1'),
    ('accepted', 4, 1, 'parolachiave','gatto'),
    ('accepted', 1, 5, 'cesare','10'),
    ('pending', 1, 3, 'pseudocasuale','3'),
    ('expired', 1, 3, 'pseudocasuale','12'),
    ('accepted', 1, 6, 'parolachiave','parolachiave');

