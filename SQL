-- PER AUTO INCREMENT:
-- GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1)


DROP TABLE Proposta;
DROP TABLE Messaggio;
DROP TABLE SistemaCifratura;
DROP TABLE Studente;

CREATE TABLE Studente (
    id int PRIMARY KEY,
    nickname    varchar(20),
    password    varchar(32),
    nome        varchar(20),
    cognome     varchar(20)
);

CREATE TABLE Messaggio (
    id              int PRIMARY KEY,
    mittente        int,
    destinatario    int,
    testo           varchar(255),
    testoCifrato    varchar(255),
    lingua          varchar(20),
    titolo          varchar(40),
    bozza           boolean,
    letto           boolean,
    FOREIGN KEY (mittente) REFERENCES Studente(id),
    FOREIGN KEY (destinatario) REFERENCES Studente(id)
);

CREATE TABLE SistemaCifratura (
    id          int PRIMARY KEY,
    creatore    int,
    metodo      varchar(20),
    chiave      varchar(20),
    FOREIGN KEY (creatore) REFERENCES Studente(id)
);

CREATE TABLE Proposta (
    id          int PRIMARY KEY,
    stato       varchar(20),
    proponente  int,
    partner     int,
    metodo      varchar(20),
    chiave      varchar(20),
    FOREIGN KEY (proponente) REFERENCES Studente(id),
    FOREIGN KEY (partner) REFERENCES Studente(id)
);

INSERT INTO Studente VALUES 
    (0, 'tory', 'pass1', 'Pietro', 'Torasso'),
    (1, 'felix', 'pass2', 'Felice', 'Cardone');
       
INSERT INTO Messaggio VALUES
    (0, 0, 1, 'testo in chiaro', 'testo cifrato', 'Italiano', 'Un titolo a caso', True, False);


-- POPOLAMENTO TABELLA "SISTEMACIFRATURA"
INSERT into SISTEMACIFRATURA (id,creatore,metodo,chiave) VALUES (2, 0, 'pseudocasuale','CIPOLLA');
INSERT into SISTEMACIFRATURA (id,creatore,metodo,chiave) VALUES (2, 0, 'cesare','1');
INSERT into SISTEMACIFRATURA (id,creatore,metodo,chiave) VALUES (3, 1, 'pseudocasuale','55');
INSERT into  CRYPTO_USER.SISTEMACIFRATURA (ID,CREATORE,METODO,CHIAVE) values (4,1,'parolachiave','papaslkfdkfjdfjl');


-- POPOLAMENTO TABELLA "PROPOSTA"
INSERT INTO Proposta VALUES
    (0, 'accepted', 0, 1, 'cesare','1')

